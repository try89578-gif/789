--[[
    Title: 999‡∏ï‡∏±‡∏ß‡∏ï‡∏∂‡∏á | ULTIMATE V4 (API + Database Hybrid + Anti-Duplicate + SettingsUI)
    Author: 999‡∏ï‡∏±‡∏ß‡∏ï‡∏∂‡∏á (Ultimate Edition)
    Features:
    - API Mode (3 ‡∏Ñ‡∏≥‡∏à‡∏≤‡∏Å Datamuse API)
    - Database Mode (‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°)
    - Auto Fallback (‡∏•‡∏≠‡∏á‡∏Ñ‡∏≥‡∏à‡∏≤‡∏Å API 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏õ Database)
    - Safe Config System
    - Anti-Duplicate System (‡πÑ‡∏°‡πà‡∏î‡∏∂‡∏á‡∏Ñ‡∏≥‡∏ã‡πâ‡∏≥‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï)
    - Pre-Turn Word Detection (‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô 0.4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    - Advanced Settings Menu (‡∏û‡∏¥‡∏°‡∏û‡πå/‡∏•‡∏ö/‡∏¢‡∏≤‡∏ß ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î/Anti-Idle)
]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer

-- ‡πÇ‡∏´‡∏•‡∏î Rayfield UI Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

--------------------------------------------------------------------
-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏£‡∏∞‡∏ö‡∏ö
--------------------------------------------------------------------

local WordDatabase = {}
local isDBLoaded = false
local isProcessing = false
local lastTypedLength = 0
local baseTypeSpeed = 0.08
local deleteSpeed = 0.05
local maxLength = 12

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Search Mode
local SearchMode = "database"  -- "api" ‡∏´‡∏£‡∏∑‡∏≠ "database"
local apiAttemptCount = 0
local maxAPIAttempts = 3
local lastAPIWords = {}
local usedAPIWords = {}

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Auto Play Mode
local isAutoPlayActive = false
local autoPlayConnection = nil
local lastDetectedPlayer = ""
local isWaitingForOtherPlayer = false

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Anti-Idle
local isAntiIdleActive = false
local antiIdleHeartbeat = nil

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ PC Emulator
local isPCEmulatorActive = false
local oldMetaIndex = nil

-- ‚≠ê Anti-Duplicate System
local usedWordsHistory = {}  -- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
local preDetectionConnection = nil  -- Connection ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô
local lastPreDetectedWord = ""  -- ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô

--------------------------------------------------------------------
-- ‚≠ê ANTI-DUPLICATE FUNCTIONS
--------------------------------------------------------------------

local function IsWordUsed(word)
    return usedWordsHistory[word:lower()] == true
end

local function MarkWordAsUsed(word)
    usedWordsHistory[word:lower()] = true
end

local function ResetUsedWords()
    usedWordsHistory = {}
    usedAPIWords = {}
    lastPreDetectedWord = ""
    Rayfield:Notify({
        Title = "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üîÑ",
        Content = "‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß",
        Duration = 3,
        Image = 4483362458,
    })
end

local function GetUsedWordsCount()
    local count = 0
    for _ in pairs(usedWordsHistory) do
        count = count + 1
    end
    return count
end

--------------------------------------------------------------------
-- ‚≠ê PRE-TURN DETECTION SYSTEM (‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô 0.4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
--------------------------------------------------------------------

local function StartPreTurnDetection()
    if preDetectionConnection then return end

    preDetectionConnection = RunService.Heartbeat:Connect(function()
        if not isAutoPlayActive then return end

        -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÄ‡∏£‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        local isMyTurn, turnText = checkIfMyTurn()

        if not isMyTurn then
            -- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÄ‡∏£‡∏≤ ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
            task.wait(0.4)  -- ‡∏£‡∏≠ 0.4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

            local extracted = extractWordFromGame()
            if extracted and #extracted > 0 and extracted ~= lastPreDetectedWord then
                lastPreDetectedWord = extracted

                -- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ
                MarkWordAsUsed(extracted)

                Rayfield:Notify({
                    Title = "üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤",
                    Content = "‡∏Ñ‡∏≥: " .. extracted:upper() .. "\n‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥",
                    Duration = 2,
                })
            end
        end
    end)
end

local function StopPreTurnDetection()
    if preDetectionConnection then
        preDetectionConnection:Disconnect()
        preDetectionConnection = nil
    end
end

--------------------------------------------------------------------
-- API SYSTEM (Datamuse API) - Enhanced with Anti-Duplicate
--------------------------------------------------------------------

local function FetchWordsFromAPI(prefix)
    if not prefix or #prefix == 0 then return nil end

    local url = "https://api.datamuse.com/words?sp=" .. prefix .. "*&max=20"  -- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 20 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô

    local success, response = pcall(function()
        return game:HttpGet(url)
    end)

    if success then
        local data = HttpService:JSONDecode(response)
        local words = {}

        for _, wordData in ipairs(data) do
            if wordData.word and #wordData.word <= maxLength then
                local word = wordData.word:lower()
                -- ‚≠ê ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≠‡∏Å
                if not IsWordUsed(word) then
                    table.insert(words, word)
                end
            end
        end

        return words
    else
        return nil
    end
end

local function GetUnusedAPIWord()
    for _, word in ipairs(lastAPIWords) do
        if not usedAPIWords[word] and not IsWordUsed(word) then  -- ‚≠ê ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏£‡∏∞‡∏ö‡∏ö
            usedAPIWords[word] = true
            return word
        end
    end
    return nil
end

--------------------------------------------------------------------
-- DATABASE SYSTEM - Enhanced with Anti-Duplicate
--------------------------------------------------------------------

local function findWordFromDatabase(prefix)
    local candidates = {}
    for _, word in ipairs(WordDatabase) do
        if #word >= 4 and #word <= maxLength and word:sub(1, #prefix) == prefix then
            -- ‚≠ê ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≠‡∏Å
            if not IsWordUsed(word) then
                table.insert(candidates, word)
                if #candidates >= 50 then break end
            end
        end
    end
    return #candidates > 0 and candidates[math.random(1, #candidates)] or nil
end

--------------------------------------------------------------------
-- GAME LOGIC FUNCTIONS
--------------------------------------------------------------------

local function extractWordFromGame()
    local inGame = LocalPlayer.PlayerGui:FindFirstChild("InGame")
    if not inGame then return nil end
    local frame = inGame:FindFirstChild("Frame")
    if not frame then return nil end
    local currentWordFolder = frame:FindFirstChild("CurrentWord")
    if not currentWordFolder then return nil end

    local letters = {}
    for _, child in pairs(currentWordFolder:GetChildren()) do
        local num = tonumber(child.Name)
        if num then
            local letter = child:FindFirstChild("Letter")
            if letter and letter:IsA("TextLabel") then
                letters[num] = letter.Text
            end
        end
    end

    local sortedLetters = {}
    for i = 1, 20 do
        if letters[i] then table.insert(sortedLetters, letters[i]) end
    end

    return table.concat(sortedLetters, ""):lower()
end

function checkIfMyTurn()
    local success, result = pcall(function()
        local inGame = LocalPlayer.PlayerGui:FindFirstChild("InGame")
        if inGame then
            local frame = inGame:FindFirstChild("Frame")
            if frame then
                local typeObj = frame:FindFirstChild("Type")
                if typeObj and (typeObj:IsA("TextLabel") or typeObj:IsA("TextBox") or typeObj:IsA("TextButton")) then
                    local text = typeObj.Text
                    if text:find(LocalPlayer.Name) then
                        return true, text
                    end
                end
            end
        end
        return false, ""
    end)

    if success then
        return result
    end
    return false, ""
end

local function findWord(prefix)
    if SearchMode == "api" then
        -- ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏à‡∏≤‡∏Å API ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ
        local unusedWord = GetUnusedAPIWord()
        if unusedWord then
            return unusedWord, "api"
        end

        -- ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏ö 3 ‡∏Ñ‡∏≥‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏õ‡∏´‡∏≤‡∏à‡∏≤‡∏Å Database
        if apiAttemptCount >= maxAPIAttempts then
            local dbWord = findWordFromDatabase(prefix)
            if dbWord then
                return dbWord, "database_fallback"
            end
        end

        return nil, nil
    else
        -- Database Mode
        local dbWord = findWordFromDatabase(prefix)
        if dbWord then
            return dbWord, "database"
        end
        return nil, nil
    end
end

local function getRandomDelay(baseSpeed)
    return math.max(0.008, baseSpeed * (0.5 + math.random() * 1))
end

local function deleteAllText()
    local deleteCount = math.max(lastTypedLength, 5)

    for i = 1, deleteCount do
        pcall(function()
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Backspace, false, game)
            task.wait(0.01)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Backspace, false, game)
        end)
        task.wait(getRandomDelay(deleteSpeed))
    end

    lastTypedLength = 0
end

local function autoType(prefix, fullWord, isAutoMode, source)
    local remaining = fullWord:sub(#prefix + 1)
    lastTypedLength = #fullWord

    -- ‚≠ê ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå
    MarkWordAsUsed(fullWord)

    task.spawn(function()
        for i = 1, #remaining do
            local char = remaining:sub(i,i):upper()
            pcall(function()
                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode[char], false, game)
                task.wait(0.01)
                VirtualInputManager:SendKeyEvent(false, Enum.KeyCode[char], false, game)
            end)
            task.wait(getRandomDelay(baseTypeSpeed))
        end

        task.wait(getRandomDelay(0.1))
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
        task.wait(0.03)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)

        -- ‡πÅ‡∏™‡∏î‡∏á Notification ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏≤
        local sourceEmoji = ""
        local sourceName = ""

        if source == "api" then
            sourceEmoji = "üåê"
            sourceName = "API (Datamuse)"
        elseif source == "database_fallback" then
            sourceEmoji = "üíæ"
            sourceName = "Database (Fallback)"
        else
            sourceEmoji = "üìö"
            sourceName = "Database"
        end

        Rayfield:Notify({
            Title = "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ " .. sourceEmoji,
            Content = string.format("‡∏Ñ‡∏≥: %s\n‡∏ó‡∏µ‡πà‡∏°‡∏≤: %s\n‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß: %d ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£\n‚ú® ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß: %d ‡∏Ñ‡∏≥", 
                fullWord:upper(),
                sourceName,
                #fullWord,
                GetUsedWordsCount()
            ),
            Duration = 3,
            Image = 4483362458,
        })

        if isAutoMode then
            task.wait(1)
            local stillMyTurn, _ = checkIfMyTurn()
            if stillMyTurn then
                -- ‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î! ‡∏•‡∏≠‡∏á‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô
                apiAttemptCount = apiAttemptCount + 1

                if apiAttemptCount >= maxAPIAttempts then
                    Rayfield:Notify({
                        Title = "‡∏Ñ‡∏≥‡∏à‡∏≤‡∏Å API ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß! üîÑ",
                        Content = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ Database ‡πÅ‡∏ó‡∏ô...",
                        Duration = 2,
                        Image = 4483362458,
                    })
                else
                    Rayfield:Notify({
                        Title = "‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î! üîÑ",
                        Content = string.format("‡∏•‡∏≠‡∏á‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô (%d/%d)", apiAttemptCount, maxAPIAttempts),
                        Duration = 2,
                        Image = 4483362458,
                    })
                end

                deleteAllText()
                task.wait(0.2)

                local extracted = extractWordFromGame()
                if extracted and #extracted > 0 then
                    local newWord, newSource = findWord(extracted)
                    if newWord and newWord ~= fullWord then
                        autoType(extracted, newWord, true, newSource)
                    else
                        isProcessing = false
                        isWaitingForOtherPlayer = true
                        apiAttemptCount = 0
                        usedAPIWords = {}
                    end
                else
                    isProcessing = false
                    isWaitingForOtherPlayer = true
                    apiAttemptCount = 0
                    usedAPIWords = {}
                end
            else
                isProcessing = false
                isWaitingForOtherPlayer = true
                apiAttemptCount = 0
                usedAPIWords = {}
            end
        else
            isProcessing = false
        end
    end)
end

local function RunAutoLogic()
    if isProcessing then return end
    if not isDBLoaded and SearchMode == "database" then 
        Rayfield:Notify({Title = "‡πÉ‡∏à‡πÄ‡∏¢‡πá‡∏ô!", Content = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...", Duration = 2})
        return 
    end

    isProcessing = true
    apiAttemptCount = 0
    usedAPIWords = {}

    local extracted = extractWordFromGame()
    if extracted and #extracted > 0 then
        -- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô API Mode ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô
        if SearchMode == "api" then
            Rayfield:Notify({
                Title = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤... üåê",
                Content = "‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API",
                Duration = 2
            })

            lastAPIWords = FetchWordsFromAPI(extracted)

            if not lastAPIWords or #lastAPIWords == 0 then
                Rayfield:Notify({
                    Title = "API ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥ ‚ö†Ô∏è",
                    Content = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ Database ‡πÅ‡∏ó‡∏ô...",
                    Duration = 2
                })
                SearchMode = "database"
            end
        end

        local foundWord, source = findWord(extracted)
        if foundWord then
            Rayfield:Notify({
                Title = "‡πÄ‡∏à‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏•‡πâ‡∏ß! üéØ",
                Content = extracted:upper() .. " -> " .. foundWord:upper(),
                Duration = 2,
                Image = 4483362458,
            })
            autoType(extracted, foundWord, false, source)
        else
            Rayfield:Notify({
                Title = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥ ‚ùå", 
                Content = string.format("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ %s (‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ)", extracted:upper()),
                Duration = 3
            })
            isProcessing = false
        end
    else
        Rayfield:Notify({Title = "‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‚ö†Ô∏è", Content = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠", Duration = 2})
        isProcessing = false
    end
end

--------------------------------------------------------------------
-- AUTO PLAY MODE
--------------------------------------------------------------------

local function StartAutoPlay()
    if autoPlayConnection then return end

    -- ‚≠ê ‡πÄ‡∏£‡∏¥‡πà‡∏° Pre-Turn Detection
    StartPreTurnDetection()

    Rayfield:Notify({
        Title = "Auto Play ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô! ü§ñ",
        Content = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...\nüîç ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô",
        Duration = 4,
        Image = 4483362458,
    })

    autoPlayConnection = RunService.Heartbeat:Connect(function()
        if not isAutoPlayActive or isProcessing then return end
        if not isDBLoaded and SearchMode == "database" then return end

        local isMyTurn, _ = checkIfMyTurn()

        if isMyTurn then
            if isWaitingForOtherPlayer and lastDetectedPlayer == LocalPlayer.Name then
                return
            elseif isWaitingForOtherPlayer then
                isWaitingForOtherPlayer = false
            end

            lastDetectedPlayer = LocalPlayer.Name
            isProcessing = true
            apiAttemptCount = 0
            usedAPIWords = {}

            task.wait(0.5)

            local extracted = extractWordFromGame()
            if extracted and #extracted > 0 then
                -- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô API Mode
                if SearchMode == "api" then
                    lastAPIWords = FetchWordsFromAPI(extracted)

                    if not lastAPIWords or #lastAPIWords == 0 then
                        SearchMode = "database"
                    end
                end

                local foundWord, source = findWord(extracted)
                if foundWord then
                    autoType(extracted, foundWord, true, source)
                else
                    isProcessing = false
                    isWaitingForOtherPlayer = true
                end
            else
                isProcessing = false
                isWaitingForOtherPlayer = true
            end
        else
            if isWaitingForOtherPlayer then
                isWaitingForOtherPlayer = false
            end
        end
    end)
end

local function StopAutoPlay()
    if autoPlayConnection then
        autoPlayConnection:Disconnect()
        autoPlayConnection = nil
    end

    -- ‚≠ê ‡∏´‡∏¢‡∏∏‡∏î Pre-Turn Detection
    StopPreTurnDetection()

    isWaitingForOtherPlayer = false
    lastDetectedPlayer = ""

    Rayfield:Notify({
        Title = "Auto Play ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß üõë",
        Content = "‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥",
        Duration = 2,
        Image = 4483362458,
    })
end

--------------------------------------------------------------------
-- PC EMULATOR
--------------------------------------------------------------------

local function EnablePCEmulator()
    if isPCEmulatorActive then return end
    if not hookmetamethod then
        Rayfield:Notify({
            Title = "‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‚ö†Ô∏è",
            Content = "Executor ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö hookmetamethod",
            Duration = 4,
        })
        return
    end

    pcall(function()
        oldMetaIndex = hookmetamethod(UserInputService, "__index", function(self, property)
            if self == UserInputService then
                if property == "KeyboardEnabled" or property == "MouseEnabled" then
                    return true
                elseif property == "TouchEnabled" then
                    return false
                end
            end
            return oldMetaIndex(self, property)
        end)

        isPCEmulatorActive = true
        Rayfield:Notify({
            Title = "PC Emulator ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß üíª",
            Content = "‡∏Å‡∏î‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß",
            Duration = 4,
            Image = 4483362458,
        })
    end)
end

--------------------------------------------------------------------
-- MOBILE LIQUID BUTTON
--------------------------------------------------------------------

local MobileButtonFrame = Instance.new("TextButton")
local ButtonStroke = Instance.new("UIStroke")
local ButtonCorner = Instance.new("UICorner")
local ButtonGradient = Instance.new("UIGradient")

MobileButtonFrame.Name = "LiquidButton"
MobileButtonFrame.Size = UDim2.fromOffset(60, 60)
MobileButtonFrame.Position = UDim2.fromScale(0.8, 0.6)
MobileButtonFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MobileButtonFrame.BackgroundTransparency = 0.2
MobileButtonFrame.Text = "üöÄ"
MobileButtonFrame.TextSize = 30
MobileButtonFrame.AutoButtonColor = false
MobileButtonFrame.Visible = false
MobileButtonFrame.Parent = MobileGui

ButtonCorner.CornerRadius = UDim.new(1, 0)
ButtonCorner.Parent = MobileButtonFrame

ButtonStroke.Thickness = 3
ButtonStroke.Transparency = 0
ButtonStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
ButtonStroke.Parent = MobileButtonFrame

ButtonGradient.Rotation = 45
ButtonGradient.Color = ColorSequence.new{ColorSequenceKeypoint.new(0, Color3.fromRGB(255,255,255)), ColorSequenceKeypoint.new(1, Color3.fromRGB(150,150,150))}
ButtonGradient.Transparency = NumberSequence.new{NumberSequenceKeypoint.new(0,0.5), NumberSequenceKeypoint.new(0.5,0.8), NumberSequenceKeypoint.new(1,0.5)}
ButtonGradient.Parent = MobileButtonFrame

-- RGB Animation
task.spawn(function()
    local hue = 0
    while MobileButtonFrame.Parent do
        hue = (hue + 0.01) % 1
        local color = Color3.fromHSV(hue, 1, 1)
        ButtonStroke.Color = color
        MobileButtonFrame.TextColor3 = color
        task.wait(0.03)
    end
end)

-- Draggable
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    MobileButtonFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MobileButtonFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MobileButtonFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)

MobileButtonFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then update(input) end
end)

MobileButtonFrame.MouseButton1Click:Connect(function()
    TweenService:Create(MobileButtonFrame, TweenInfo.new(0.1), {Size = UDim2.fromOffset(50,50)}):Play()
    task.wait(0.1)
    TweenService:Create(MobileButtonFrame, TweenInfo.new(0.1), {Size = UDim2.fromOffset(60,60)}):Play()
    RunAutoLogic()
end)

--------------------------------------------------------------------
-- ‡∏™‡∏£‡πâ‡∏≤‡∏á ScreenGui (‡∏ó‡∏≥‡∏´‡∏•‡∏±‡∏á MobileButton ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà error)
--------------------------------------------------------------------
local MobileGui = MobileButtonFrame.Parent

--------------------------------------------------------------------
-- RAYFIELD UI
--------------------------------------------------------------------

local Window = Rayfield:CreateWindow({
   Name = "999‡∏ï‡∏±‡∏ß‡∏ï‡∏∂‡∏á | Ultimate Word Solver V4 Enhanced",
   LoadingTitle = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏∂‡∏á...",
   LoadingSubtitle = "by 999‡∏ï‡∏±‡∏ß‡∏ï‡∏∂‡∏á (Anti-Duplicate + Settings Edition)",
   ConfigurationSaving = {Enabled = true, FolderName = "999SolverConfig", FileName = "Manager"},
   Discord = {Enabled = false},
   KeySystem = false,
})

local MainTab = Window:CreateTab("‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å", 4483362458)
local SettingsTab = Window:CreateTab("‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤", 4483362458)

--------------------------------------------------------------------
-- MAIN TAB
--------------------------------------------------------------------

MainTab:CreateSection("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤")

MainTab:CreateDropdown({
   Name = "üîç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå",
   Options = {"API Mode (Datamuse - 3 ‡∏Ñ‡∏≥)", "Database Mode (‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)"},
   CurrentOption = {"Database Mode (‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)"},
   MultipleOptions = false,
   Flag = "SearchModeDropdown",
   Callback = function(Option)
        if Option[1] == "API Mode (Datamuse - 3 ‡∏Ñ‡∏≥)" then
            SearchMode = "api"
            Rayfield:Notify({
                Title = "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô API Mode üåê",
                Content = "‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ñ‡∏≥‡∏à‡∏≤‡∏Å Datamuse API (3 ‡∏Ñ‡∏≥ ‡∏•‡∏≠‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ Database)",
                Duration = 3
            })
        else
            SearchMode = "database"
            Rayfield:Notify({
                Title = "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Database Mode üìö",
                Content = "‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô",
                Duration = 3
            })
        end
   end,
})

MainTab:CreateParagraph({
    Title = "üí° ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏´‡∏°‡∏î",
    Content = "API Mode: ‡∏î‡∏∂‡∏á 3 ‡∏Ñ‡∏≥‡∏à‡∏≤‡∏Å Server, ‡∏•‡∏≠‡∏á‡∏ó‡∏µ‡∏•‡∏∞‡∏Ñ‡∏≥, ‡∏´‡∏°‡∏î‡πÑ‡∏õ Database\nDatabase Mode: ‡πÉ‡∏ä‡πâ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô (‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß)\n‚≠ê ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ã‡πâ‡∏≥: ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Å‡∏î‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï"
})

MainTab:CreateSection("‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡πÇ‡∏ï‡πâ")

MainTab:CreateButton({
   Name = "üöÄ ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏Ñ‡∏≥ (Run Once)",
   Callback = RunAutoLogic
})

MainTab:CreateToggle({
   Name = "ü§ñ Auto Play Mode (‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏Å‡∏°)",
   CurrentValue = false,
   Flag = "AutoPlayToggle",
   Callback = function(v)
        isAutoPlayActive = v
        if v then StartAutoPlay() else StopAutoPlay() end
   end,
})

MainTab:CreateToggle({
   Name = "üì± ‡∏õ‡∏∏‡πà‡∏°‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (Liquid RGB Button)",
   CurrentValue = false,
   Flag = "MobileBtnToggle",
   Callback = function(v) MobileButtonFrame.Visible = v end,
})

MainTab:CreateToggle({
   Name = "üíª PC Emulator (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)",
   CurrentValue = false,
   Flag = "PCEmulatorToggle",
   Callback = function(v)
        if v then EnablePCEmulator() end
   end,
})

-- ‚≠ê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô Anti-Duplicate
MainTab:CreateSection("üîÑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ã‡πâ‡∏≥")

MainTab:CreateButton({
   Name = "üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ",
   Callback = function()
        ResetUsedWords()
   end,
})

MainTab:CreateButton({
   Name = "üìä ‡∏î‡∏π‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß",
   Callback = function()
        Rayfield:Notify({
            Title = "üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥",
            Content = string.format("‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß: %d ‡∏Ñ‡∏≥\n‚ú® ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ã‡πâ‡∏≥‡∏ó‡∏≥‡∏á‡∏≤‡∏ô\nüîç ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ 0.4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ", GetUsedWordsCount()),
            Duration = 4,
            Image = 4483362458,
        })
   end,
})

MainTab:CreateParagraph({
    Title = "‚ÑπÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ã‡πâ‡∏≥",
    Content = "‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏î‡∏à‡∏≥‡∏Ñ‡∏≥‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ\n‚Ä¢ ‡πÑ‡∏°‡πà‡∏î‡∏∂‡∏á‡∏Ñ‡∏≥‡∏ã‡πâ‡∏≥‡∏à‡∏≤‡∏Å API ‡πÅ‡∏•‡∏∞ Database\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô 0.4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ\n‚Ä¢ ‡∏Å‡∏î‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥"
})

--------------------------------------------------------------------
-- SETTINGS TAB (‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á hmmmm.txt)
--------------------------------------------------------------------

SettingsTab:CreateSection("‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå")

SettingsTab:CreateSlider({
   Name = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)",
   Range = {0.01, 0.5}, Increment = 0.01, Suffix = "s",
   CurrentValue = baseTypeSpeed, Flag = "SpeedSlider",
   Callback = function(v) baseTypeSpeed = v end,
})

SettingsTab:CreateSlider({
   Name = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏≥ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)",
   Range = {0.01, 0.2}, Increment = 0.01, Suffix = "s",
   CurrentValue = deleteSpeed, Flag = "DeleteSpeedSlider",
   Callback = function(v) deleteSpeed = v end,
})

SettingsTab:CreateInput({
   Name = "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ñ‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î",
   PlaceholderText = tostring(maxLength),
   Callback = function(t) maxLength = tonumber(t) or 12 end,
})

SettingsTab:CreateSection("‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏£‡∏¥‡∏°")

SettingsTab:CreateToggle({
    Name = "üõ°Ô∏è Anti-Idle (‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏∏‡∏î - ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£)",
    CurrentValue = false,
    Flag = "AntiIdle",
    Callback = function(Value)
        isAntiIdleActive = Value

        if Value then
            Rayfield:Notify({Title = "Anti-Idle", Content = "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ 100%)", Duration = 3})

            antiIdleHeartbeat = RunService.Heartbeat:Connect(function()
                if not isAntiIdleActive then return end

                if math.random() < 0.005 then
                    pcall(function()
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.RightControl, false, game)
                        task.wait(0.05)
                        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.RightControl, false, game)
                    end)
                end
            end)

        else
            Rayfield:Notify({Title = "Anti-Idle", Content = "‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß", Duration = 2})
            if antiIdleHeartbeat then
                antiIdleHeartbeat:Disconnect()
                antiIdleHeartbeat = nil
            end
        end
    end,
})

SettingsTab:CreateButton({
    Name = "‚ùå ‡∏õ‡∏¥‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå (Unload)",
    Callback = function()
        if autoPlayConnection then autoPlayConnection:Disconnect() end
        if antiIdleHeartbeat then antiIdleHeartbeat:Disconnect() end
        if preDetectionConnection then preDetectionConnection:Disconnect() end
        MobileGui:Destroy()
        Rayfield:Destroy()
    end,
})

--------------------------------------------------------------------
-- ‡πÇ‡∏´‡∏•‡∏î Database
--------------------------------------------------------------------

task.spawn(function()
    Rayfield:Notify({Title = "Database", Content = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå...", Duration = 3})

    local success, result = pcall(game.HttpGet, game, "https://raw.githubusercontent.com/try89578-gif/789/refs/heads/main/500k.txt")

    if success then
        for word in result:gmatch("[a-zA-Z]+") do
            if #word >= 3 and #word <= 20 then
                table.insert(WordDatabase, word:lower())
            end
        end
        isDBLoaded = true
        Rayfield:Notify({Title = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! ‚úÖ", Content = "‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå " .. #WordDatabase .. " ‡∏Ñ‡∏≥", Duration = 4})
    else
        local backup = {"apple","banana","cat","dog","umbrella","house","water","table","chair","book"}
        for _, w in ipairs(backup) do table.insert(WordDatabase, w) end
        isDBLoaded = true
        Rayfield:Notify({Title = "‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‚ö†Ô∏è", Content = "‡πÉ‡∏ä‡πâ Database ‡∏™‡∏≥‡∏£‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡πá‡∏ï)", Duration = 4})
    end
end)

-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
task.spawn(function()
    task.wait(3)
    if UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled then
        Rayfield:Notify({
            Title = "‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ üì±",
            Content = "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡∏¥‡∏î 'PC Emulator' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏Å‡∏î‡∏Ñ‡∏µ‡∏¢‡πå‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥",
            Duration = 6,
            Image = 4483362458,
        })
    end
end)